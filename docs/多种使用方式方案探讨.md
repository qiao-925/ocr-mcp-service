# OCR æœåŠ¡å¤šç§ä½¿ç”¨æ–¹å¼æ–¹æ¡ˆæ¢è®¨

> **è®¨è®ºä¸»é¢˜**: é™¤äº† MCP åè®®å¤–ï¼Œå¦‚ä½•è®©ç”¨æˆ·é€šè¿‡å…¶ä»–æ–¹å¼ä½¿ç”¨ OCR å·¥å…·ï¼Ÿ

---

## ğŸ¯ å½“å‰çŠ¶æ€

### ç°æœ‰ä½¿ç”¨æ–¹å¼

1. **MCP åè®®**ï¼ˆä¸»è¦æ–¹å¼ï¼‰
   - é€šè¿‡ Cursor ç­‰ AI ç¼–è¾‘å™¨è°ƒç”¨
   - ä½¿ç”¨ stdio JSON-RPC é€šä¿¡
   - é€‚åˆ AI Agent é›†æˆ

2. **å‘½ä»¤è¡Œè„šæœ¬**ï¼ˆéƒ¨åˆ†æ”¯æŒï¼‰
   - `scripts/recognize_image.py` - åŸºç¡€ CLI å·¥å…·
   - `scripts/compare_engines.py` - å¼•æ“å¯¹æ¯”å·¥å…·
   - åŠŸèƒ½æœ‰é™ï¼Œç”¨æˆ·ä½“éªŒä¸€èˆ¬

3. **Python åº“**ï¼ˆå¯å¯¼å…¥ä½¿ç”¨ï¼‰
   - å¯ä»¥ç›´æ¥å¯¼å…¥ `ocr_mcp_service.ocr_engine` ä½¿ç”¨
   - ä½†ç¼ºå°‘å‹å¥½çš„ API å°è£…

---

## ğŸ’¡ æ‰©å±•æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: å®Œå–„çš„ CLI å‘½ä»¤è¡Œå·¥å…· â­â­â­â­â­

**ä¼˜åŠ¿**:
- âœ… å®ç°ç®€å•ï¼Œå¼€å‘æˆæœ¬ä½
- âœ… é€‚åˆè„šæœ¬è‡ªåŠ¨åŒ–åœºæ™¯
- âœ… æ— éœ€é¢å¤–æœåŠ¡ï¼Œå³è£…å³ç”¨
- âœ… å¯ä»¥é›†æˆåˆ°å…¶ä»–å·¥å…·é“¾

**å®ç°æ–¹å¼**:
```bash
# åŸºç¡€ä½¿ç”¨
ocr-recognize image.jpg

# æŒ‡å®šå¼•æ“
ocr-recognize image.jpg --engine paddleocr

# è¾“å‡ºæ ¼å¼
ocr-recognize image.jpg --output json
ocr-recognize image.jpg --output text
ocr-recognize image.jpg --output markdown

# æ‰¹é‡å¤„ç†
ocr-recognize *.jpg --output-dir results/

# å¯¹æ¯”å¤šä¸ªå¼•æ“
ocr-compare image.jpg --engines paddleocr,easyocr
```

**æŠ€æœ¯å®ç°**:
- æ‰©å±•ç°æœ‰çš„ `recognize_image.py`
- æ·»åŠ æ‰¹é‡å¤„ç†ã€æ ¼å¼è½¬æ¢ç­‰åŠŸèƒ½
- ä½¿ç”¨ `click` æˆ– `argparse` æ„å»º CLI

**ä¼˜å…ˆçº§**: ğŸ”¥ é«˜ï¼ˆå¿«é€Ÿå®ç°ï¼Œç”¨æˆ·éœ€æ±‚æ˜ç¡®ï¼‰

---

### æ–¹æ¡ˆ 2: REST API æœåŠ¡ â­â­â­â­

**ä¼˜åŠ¿**:
- âœ… è·¨è¯­è¨€ã€è·¨å¹³å°ä½¿ç”¨
- âœ… å¯ä»¥éƒ¨ç½²ä¸ºç‹¬ç«‹æœåŠ¡
- âœ… é€‚åˆé›†æˆåˆ° Web åº”ç”¨
- âœ… æ”¯æŒè¿œç¨‹è°ƒç”¨

**å®ç°æ–¹å¼**:
```python
# ä½¿ç”¨ FastAPI æˆ– Flask
from fastapi import FastAPI, File, UploadFile
from ocr_mcp_service.ocr_engine import OCREngineFactory

app = FastAPI()

@app.post("/api/ocr/recognize")
async def recognize_image(
    file: UploadFile,
    engine: str = "paddleocr",
    lang: str = "ch"
):
    # ä¿å­˜ä¸Šä¼ æ–‡ä»¶
    # è°ƒç”¨ OCR å¼•æ“
    # è¿”å›ç»“æœ
    pass
```

**API è®¾è®¡**:
```
POST /api/ocr/recognize
  - ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶
  - è¿”å› JSON ç»“æœ

POST /api/ocr/batch
  - æ‰¹é‡ä¸Šä¼ å›¾ç‰‡
  - è¿”å›æ‰¹é‡ç»“æœ

GET /api/engines
  - åˆ—å‡ºå¯ç”¨å¼•æ“

GET /api/health
  - å¥åº·æ£€æŸ¥
```

**éƒ¨ç½²æ–¹å¼**:
- æœ¬åœ°æœåŠ¡: `ocr-api serve --port 8000`
- Docker å®¹å™¨: `docker run ocr-api`
- äº‘æœåŠ¡: éƒ¨ç½²åˆ°æœåŠ¡å™¨

**ä¼˜å…ˆçº§**: ğŸ”¥ é«˜ï¼ˆé€šç”¨æ€§å¼ºï¼Œåº”ç”¨åœºæ™¯å¹¿ï¼‰

---

### æ–¹æ¡ˆ 3: Python åº“ API â­â­â­â­

**ä¼˜åŠ¿**:
- âœ… ç›´æ¥é›†æˆåˆ° Python é¡¹ç›®
- âœ… æ— éœ€é¢å¤–æœåŠ¡
- âœ… ç±»å‹æç¤ºå®Œå–„
- âœ… é€‚åˆå¼€å‘è€…ä½¿ç”¨

**å®ç°æ–¹å¼**:
```python
# å‹å¥½çš„ API è®¾è®¡
from ocr_mcp_service import OCRClient

# ç®€å•ä½¿ç”¨
client = OCRClient()
result = client.recognize("image.jpg")

# æŒ‡å®šå¼•æ“
result = client.recognize("image.jpg", engine="paddleocr")

# æ‰¹é‡å¤„ç†
results = client.recognize_batch(["img1.jpg", "img2.jpg"])

# å¯¹æ¯”å¼•æ“
comparison = client.compare_engines("image.jpg", engines=["paddleocr", "easyocr"])
```

**API è®¾è®¡**:
```python
class OCRClient:
    """ç”¨æˆ·å‹å¥½çš„ OCR å®¢æˆ·ç«¯"""
    
    def recognize(
        self,
        image_path: str,
        engine: str = "paddleocr",
        **kwargs
    ) -> OCRResult:
        """è¯†åˆ«å•å¼ å›¾ç‰‡"""
        pass
    
    def recognize_batch(
        self,
        image_paths: List[str],
        engine: str = "paddleocr",
        **kwargs
    ) -> List[OCRResult]:
        """æ‰¹é‡è¯†åˆ«"""
        pass
    
    def compare_engines(
        self,
        image_path: str,
        engines: List[str]
    ) -> Dict[str, OCRResult]:
        """å¯¹æ¯”å¤šä¸ªå¼•æ“"""
        pass
```

**ä¼˜å…ˆçº§**: ğŸ”¥ ä¸­é«˜ï¼ˆæå‡å¼€å‘è€…ä½“éªŒï¼‰

---

### æ–¹æ¡ˆ 4: Web ç•Œé¢ â­â­â­

**ä¼˜åŠ¿**:
- âœ… ç”¨æˆ·å‹å¥½ï¼Œæ— éœ€å‘½ä»¤è¡ŒçŸ¥è¯†
- âœ… å¯è§†åŒ–ç»“æœå±•ç¤º
- âœ… æ”¯æŒæ‹–æ‹½ä¸Šä¼ 
- âœ… é€‚åˆéæŠ€æœ¯ç”¨æˆ·

**å®ç°æ–¹å¼**:
- å‰ç«¯: React/Vue + æ–‡ä»¶ä¸Šä¼ ç»„ä»¶
- åç«¯: FastAPI + é™æ€æ–‡ä»¶æœåŠ¡
- åŠŸèƒ½:
  - å›¾ç‰‡ä¸Šä¼ ï¼ˆæ‹–æ‹½/ç‚¹å‡»ï¼‰
  - å¼•æ“é€‰æ‹©
  - å®æ—¶è¿›åº¦æ˜¾ç¤º
  - ç»“æœå±•ç¤ºï¼ˆæ–‡æœ¬ + å¯è§†åŒ–æ¡†ï¼‰
  - ç»“æœå¯¼å‡ºï¼ˆæ–‡æœ¬/JSON/Markdownï¼‰

**æŠ€æœ¯æ ˆ**:
- å‰ç«¯: React + Ant Design / Vue + Element UI
- åç«¯: FastAPIï¼ˆå¤ç”¨æ–¹æ¡ˆ2çš„APIï¼‰
- éƒ¨ç½²: å•é¡µåº”ç”¨ + API æœåŠ¡

**ä¼˜å…ˆçº§**: ğŸ”¥ ä¸­ï¼ˆéœ€è¦å‰ç«¯å¼€å‘ï¼Œé€‚åˆé¢å‘æ™®é€šç”¨æˆ·ï¼‰

---

### æ–¹æ¡ˆ 5: æ¡Œé¢åº”ç”¨ â­â­

**ä¼˜åŠ¿**:
- âœ… å®Œå…¨ç¦»çº¿ä½¿ç”¨
- âœ… åŸç”Ÿä½“éªŒ
- âœ… å¯ä»¥é›†æˆç³»ç»ŸåŠŸèƒ½

**å®ç°æ–¹å¼**:
- ä½¿ç”¨ Electron + Reactï¼ˆè·¨å¹³å°ï¼‰
- æˆ–ä½¿ç”¨ PyQt/Tkinterï¼ˆPython åŸç”Ÿï¼‰
- åŠŸèƒ½ç±»ä¼¼ Web ç•Œé¢ï¼Œä½†ä½œä¸ºç‹¬ç«‹åº”ç”¨

**ä¼˜å…ˆçº§**: ğŸ”¥ ä½ï¼ˆå¼€å‘æˆæœ¬é«˜ï¼Œç”¨æˆ·éœ€æ±‚ä¸æ˜ç¡®ï¼‰

---

## ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | å¼€å‘æˆæœ¬ | ç”¨æˆ·å‹å¥½åº¦ | é€šç”¨æ€§ | ä¼˜å…ˆçº§ | æ¨èåº¦ |
|------|---------|-----------|--------|--------|--------|
| CLI å·¥å…· | â­â­ ä½ | â­â­â­ ä¸­ | â­â­â­â­ é«˜ | ğŸ”¥ğŸ”¥ğŸ”¥ é«˜ | â­â­â­â­â­ |
| REST API | â­â­â­ ä¸­ | â­â­â­â­ é«˜ | â­â­â­â­â­ å¾ˆé«˜ | ğŸ”¥ğŸ”¥ğŸ”¥ é«˜ | â­â­â­â­â­ |
| Python åº“ | â­â­ ä½ | â­â­â­ ä¸­ | â­â­â­ ä¸­ | ğŸ”¥ğŸ”¥ ä¸­é«˜ | â­â­â­â­ |
| Web ç•Œé¢ | â­â­â­â­ é«˜ | â­â­â­â­â­ å¾ˆé«˜ | â­â­â­â­ é«˜ | ğŸ”¥ğŸ”¥ ä¸­ | â­â­â­ |
| æ¡Œé¢åº”ç”¨ | â­â­â­â­â­ å¾ˆé«˜ | â­â­â­â­â­ å¾ˆé«˜ | â­â­ ä½ | ğŸ”¥ ä½ | â­â­ |

---

## ğŸ¯ æ¨èå®æ–½è·¯çº¿

### ç¬¬ä¸€é˜¶æ®µï¼šå¿«é€Ÿå®ç°ï¼ˆ1-2å¤©ï¼‰

1. **å®Œå–„ CLI å·¥å…·** â­â­â­â­â­
   - æ‰©å±• `recognize_image.py`
   - æ·»åŠ æ‰¹é‡å¤„ç†ã€æ ¼å¼è¾“å‡º
   - æ·»åŠ å¼•æ“å¯¹æ¯”åŠŸèƒ½
   - åˆ›å»ºç»Ÿä¸€çš„ `ocr` å‘½ä»¤å…¥å£

2. **ä¼˜åŒ– Python åº“ API** â­â­â­â­
   - åˆ›å»º `OCRClient` ç±»
   - æä¾›å‹å¥½çš„ API æ¥å£
   - å®Œå–„ç±»å‹æç¤ºå’Œæ–‡æ¡£

### ç¬¬äºŒé˜¶æ®µï¼šæœåŠ¡åŒ–ï¼ˆ3-5å¤©ï¼‰

3. **REST API æœåŠ¡** â­â­â­â­â­
   - ä½¿ç”¨ FastAPI å®ç°
   - æ”¯æŒå•å¼ /æ‰¹é‡è¯†åˆ«
   - æ·»åŠ å¥åº·æ£€æŸ¥å’Œæ–‡æ¡£
   - æ”¯æŒ Docker éƒ¨ç½²

### ç¬¬ä¸‰é˜¶æ®µï¼šç”¨æˆ·ä½“éªŒï¼ˆå¯é€‰ï¼Œ5-10å¤©ï¼‰

4. **Web ç•Œé¢** â­â­â­
   - ç®€å•çš„å‰ç«¯ç•Œé¢
   - é›†æˆ REST API
   - æ”¯æŒæ–‡ä»¶ä¸Šä¼ å’Œç»“æœå±•ç¤º

---

## ğŸ’» æŠ€æœ¯å®ç°å»ºè®®

### CLI å·¥å…·å®ç°

```python
# scripts/cli.py
import click
from ocr_mcp_service.ocr_engine import OCREngineFactory

@click.group()
def cli():
    """OCR å‘½ä»¤è¡Œå·¥å…·"""
    pass

@cli.command()
@click.argument('image_path')
@click.option('--engine', default='paddleocr', help='OCRå¼•æ“')
@click.option('--output', type=click.Choice(['text', 'json', 'markdown']), default='text')
def recognize(image_path, engine, output):
    """è¯†åˆ«å›¾ç‰‡ä¸­çš„æ–‡å­—"""
    # å®ç°è¯†åˆ«é€»è¾‘
    pass

@cli.command()
@click.argument('image_path')
@click.option('--engines', default='paddleocr,easyocr', help='è¦å¯¹æ¯”çš„å¼•æ“')
def compare(image_path, engines):
    """å¯¹æ¯”å¤šä¸ªå¼•æ“çš„è¯†åˆ«ç»“æœ"""
    # å®ç°å¯¹æ¯”é€»è¾‘
    pass
```

### REST API å®ç°

```python
# src/ocr_mcp_service/api.py
from fastapi import FastAPI, File, UploadFile
from fastapi.responses import JSONResponse
from ocr_mcp_service.ocr_engine import OCREngineFactory

app = FastAPI(title="OCR API Service")

@app.post("/api/ocr/recognize")
async def recognize_image(
    file: UploadFile,
    engine: str = "paddleocr",
    lang: str = "ch"
):
    """è¯†åˆ«ä¸Šä¼ çš„å›¾ç‰‡"""
    # ä¿å­˜ä¸´æ—¶æ–‡ä»¶
    # è°ƒç”¨ OCR å¼•æ“
    # è¿”å›ç»“æœ
    pass
```

### Python åº“ API å®ç°

```python
# src/ocr_mcp_service/client.py
from typing import List, Dict, Optional
from pathlib import Path
from .ocr_engine import OCREngineFactory
from .models import OCRResult

class OCRClient:
    """ç”¨æˆ·å‹å¥½çš„ OCR å®¢æˆ·ç«¯"""
    
    def __init__(self, default_engine: str = "paddleocr"):
        self.default_engine = default_engine
    
    def recognize(
        self,
        image_path: str,
        engine: Optional[str] = None,
        **kwargs
    ) -> OCRResult:
        """è¯†åˆ«å•å¼ å›¾ç‰‡"""
        engine = engine or self.default_engine
        ocr_engine = OCREngineFactory.get_engine(engine, **kwargs)
        return ocr_engine.recognize_image(image_path)
    
    def recognize_batch(
        self,
        image_paths: List[str],
        engine: Optional[str] = None,
        **kwargs
    ) -> List[OCRResult]:
        """æ‰¹é‡è¯†åˆ«"""
        return [self.recognize(path, engine, **kwargs) for path in image_paths]
    
    def compare_engines(
        self,
        image_path: str,
        engines: List[str]
    ) -> Dict[str, OCRResult]:
        """å¯¹æ¯”å¤šä¸ªå¼•æ“"""
        results = {}
        for engine in engines:
            results[engine] = self.recognize(image_path, engine=engine)
        return results
```

---

## ğŸ¨ ç”¨æˆ·ä½“éªŒè®¾è®¡

### CLI å·¥å…·ä½“éªŒ

```bash
# ç®€å•ç›´è§‚çš„å‘½ä»¤
$ ocr image.jpg
è¯†åˆ«ç»“æœ: [æ–‡æœ¬å†…å®¹]

# ä¸°å¯Œçš„é€‰é¡¹
$ ocr image.jpg --engine paddleocr --output json --save result.json

# æ‰¹é‡å¤„ç†
$ ocr *.jpg --output-dir results/

# å¯¹æ¯”å¼•æ“
$ ocr-compare image.jpg
å¼•æ“å¯¹æ¯”ç»“æœ:
- paddleocr: 0.98 ç½®ä¿¡åº¦, 1.2s
- easyocr: 0.95 ç½®ä¿¡åº¦, 1.5s
```

### REST API ä½“éªŒ

```bash
# å•å¼ è¯†åˆ«
curl -X POST http://localhost:8000/api/ocr/recognize \
  -F "file=@image.jpg" \
  -F "engine=paddleocr"

# æ‰¹é‡è¯†åˆ«
curl -X POST http://localhost:8000/api/ocr/batch \
  -F "files=@img1.jpg" \
  -F "files=@img2.jpg"
```

### Python åº“ä½“éªŒ

```python
# ç®€å•æ˜“ç”¨
from ocr_mcp_service import OCRClient

client = OCRClient()
result = client.recognize("image.jpg")
print(result.text)

# æ‰¹é‡å¤„ç†
results = client.recognize_batch(["img1.jpg", "img2.jpg"])

# å¯¹æ¯”å¼•æ“
comparison = client.compare_engines("image.jpg", ["paddleocr", "easyocr"])
```

---

## ğŸ“ æ€»ç»“

### æ ¸å¿ƒå»ºè®®

1. **ä¼˜å…ˆå®ç° CLI å·¥å…·** - å¿«é€Ÿæ»¡è¶³ç”¨æˆ·éœ€æ±‚ï¼Œå¼€å‘æˆæœ¬ä½
2. **å…¶æ¬¡å®ç° REST API** - æä¾›é€šç”¨æ¥å£ï¼Œæ”¯æŒå¤šç§é›†æˆæ–¹å¼
3. **ä¼˜åŒ– Python åº“ API** - æå‡å¼€å‘è€…ä½“éªŒ
4. **å¯é€‰ Web ç•Œé¢** - æ ¹æ®ç”¨æˆ·åé¦ˆå†³å®šæ˜¯å¦å¼€å‘

### å®æ–½åŸåˆ™

- âœ… **æ¸è¿›å¼å¼€å‘** - å…ˆå®ç°æ ¸å¿ƒåŠŸèƒ½ï¼Œå†æ‰©å±•
- âœ… **å¤ç”¨ç°æœ‰ä»£ç ** - åŸºäºç°æœ‰çš„ `ocr_engine.py` å®ç°
- âœ… **ä¿æŒä¸€è‡´æ€§** - æ‰€æœ‰æ–¹å¼ä½¿ç”¨ç›¸åŒçš„åº•å±‚å¼•æ“
- âœ… **æ–‡æ¡£å®Œå–„** - ä¸ºæ¯ç§ä½¿ç”¨æ–¹å¼æä¾›æ¸…æ™°æ–‡æ¡£

---

**è®¨è®ºè¦ç‚¹**: 
- ä½ æ›´å€¾å‘äºå“ªç§ä½¿ç”¨æ–¹å¼ï¼Ÿ
- æ˜¯å¦æœ‰ç‰¹å®šçš„ä½¿ç”¨åœºæ™¯éœ€æ±‚ï¼Ÿ
- æ˜¯å¦éœ€è¦æˆ‘ç«‹å³å¼€å§‹å®ç°æŸä¸ªæ–¹æ¡ˆï¼Ÿ

