å—¯# OCR MCP Service å®Œæ•´æ–‡æ¡£

> **ç‰ˆæœ¬**: 0.1.0  
> **æœ€åæ›´æ–°**: 2025-11-27  
> **çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

OCR MCP Service æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„ OCR æœåŠ¡ï¼Œé€šè¿‡ MCP (Model Context Protocol) æä¾›å¤šç§ OCR å¼•æ“æ”¯æŒã€‚

### æ ¸å¿ƒç‰¹æ€§

- âœ… ç»Ÿä¸€æœåŠ¡æ¶æ„ï¼Œå•ä¸€å…¥å£ç‚¹
- âœ… å¤šå¼•æ“æ”¯æŒï¼ˆPaddleOCRã€EasyOCRã€DeepSeek OCRã€paddleocr-mcpï¼‰
- âœ… æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•
- âœ… å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- âœ… è¿›åº¦è·Ÿè¸ªå’ŒæŠ€æœ¯åˆ†æ

### æŠ€æœ¯æ ˆ

- **Python**: 3.10+ï¼ˆæ¨è 3.11ï¼‰
- **åŒ…ç®¡ç†**: uvï¼ˆç°ä»£åŒ– Python åŒ…ç®¡ç†å™¨ï¼‰
- **MCP åè®®**: Model Context Protocolï¼ˆåŸºäº stdio JSON-RPCï¼‰
- **æ¡†æ¶**: FastMCP

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…

```bash
# ä½¿ç”¨ uvï¼ˆæ¨èï¼‰
uv venv
uv pip install -e ".[paddleocr]"  # å®‰è£… PaddleOCR å¼•æ“

# æˆ–ä½¿ç”¨ pip
pip install -e ".[paddleocr]"
```

### é…ç½® Cursor

```bash
# è‡ªåŠ¨é…ç½®åˆ° Cursor
python scripts/setup_cursor.py

# æˆ–æ‰‹åŠ¨æ·»åŠ åˆ° ~/.cursor/mcp.json
{
  "mcpServers": {
    "ocr-service": {
      "command": "ocr-mcp-server",
      "args": []
    }
  }
}
```

### ä½¿ç”¨

åœ¨ Cursor ä¸­ç›´æ¥è°ƒç”¨å·¥å…·ï¼š

```
è¯·ä½¿ç”¨ recognize_image_paddleocr å·¥å…·è¯†åˆ«å›¾ç‰‡ï¼šå›¾ç‰‡è·¯å¾„
```

---

## ğŸ“– API å‚è€ƒ

### å·¥å…·åˆ—è¡¨

#### 1. recognize_image_paddleocr

ä½¿ç”¨ PaddleOCR å¼•æ“è¯†åˆ«å›¾ç‰‡ä¸­çš„æ–‡å­—ï¼ˆæ¨èï¼‰ã€‚

**å‚æ•°**:
- `image_path` (str): å›¾ç‰‡æ–‡ä»¶è·¯å¾„
- `lang` (str, å¯é€‰): è¯­è¨€ä»£ç ï¼Œé»˜è®¤ä¸º "ch"

**è¿”å›**:
```json
{
  "text": "è¯†åˆ«çš„æ–‡å­—å†…å®¹",
  "boxes": [{"x1": 0.0, "y1": 0.0, "x2": 100.0, "y2": 50.0}],
  "confidence": 0.95,
  "engine": "paddleocr",
  "processing_time": 1.23,
  "analysis": "æŠ€æœ¯è§£æ...",
  "progress_history": [...]
}
```

#### 2. recognize_image_easyocr

ä½¿ç”¨ EasyOCR å¼•æ“è¯†åˆ«å›¾ç‰‡ä¸­çš„æ–‡å­—ï¼ˆæ”¯æŒ80+è¯­è¨€ï¼‰ã€‚

**å‚æ•°**:
- `image_path` (str): å›¾ç‰‡æ–‡ä»¶è·¯å¾„
- `languages` (str, å¯é€‰): é€—å·åˆ†éš”çš„è¯­è¨€ä»£ç ï¼Œé»˜è®¤ä¸º "ch_sim,en"

**è¿”å›**: åŒ `recognize_image_paddleocr`

#### 3. recognize_image_paddleocr_mcp

ä½¿ç”¨ paddleocr-mcp å¼•æ“è¯†åˆ«å›¾ç‰‡ä¸­çš„æ–‡å­—ã€‚

**å‚æ•°**:
- `image_path` (str): å›¾ç‰‡æ–‡ä»¶è·¯å¾„

**è¿”å›**: åŒ `recognize_image_paddleocr`

#### 4. recognize_image_deepseek

ä½¿ç”¨ DeepSeek OCR å¼•æ“è¯†åˆ«å›¾ç‰‡ä¸­çš„æ–‡å­—ï¼ˆâš ï¸ ä¸æ¨èï¼Œæ¨¡å‹è¿‡å¤§ ~7.8GBï¼‰ã€‚

**å‚æ•°**:
- `image_path` (str): å›¾ç‰‡æ–‡ä»¶è·¯å¾„

**è¿”å›**: åŒ `recognize_image_paddleocr`ï¼ˆä½† `boxes` ä¸ºç©ºï¼‰

#### 5. get_recent_logs

è·å– OCR æœåŠ¡çš„æœ€è¿‘æ—¥å¿—è®°å½•ã€‚

**å‚æ•°**:
- `lines` (int, å¯é€‰): è¿”å›çš„æ—¥å¿—è¡Œæ•°ï¼Œé»˜è®¤ 100ï¼Œæœ€å¤§ 1000
- `level` (str, å¯é€‰): è¿‡æ»¤æ—¥å¿—çº§åˆ«ï¼ˆdebug/info/warning/errorï¼‰
- `engine` (str, å¯é€‰): è¿‡æ»¤å¼•æ“åç§°
- `search` (str, å¯é€‰): æœç´¢å…³é”®è¯

**è¿”å›**:
```json
{
  "logs": [
    {
      "timestamp": "2025-01-27 20:00:00",
      "level": "info",
      "logger": "PaddleOCREngine",
      "message": "OCRè¯†åˆ«å®Œæˆ",
      "progress": 100.0,
      "stage": "å®Œæˆ"
    }
  ],
  "total": 100,
  "filtered": 50
}
```

### é”™è¯¯å¤„ç†

å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œè¿”å›ç»“æœä¸­ä¼šåŒ…å« `error` å­—æ®µï¼š

```json
{
  "error": "é”™è¯¯ä¿¡æ¯",
  "text": "",
  "boxes": [],
  "confidence": 0.0,
  "engine": "engine_name",
  "processing_time": 0.0
}
```

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒç»„ä»¶

1. **MCP æœåŠ¡å™¨** (`mcp_server.py`)
   - FastMCP æ¡†æ¶
   - ç»Ÿä¸€çš„æœåŠ¡å™¨å®ä¾‹
   - MCP æ—¥å¿—é€šçŸ¥æ”¯æŒ

2. **å·¥å…·å®šä¹‰** (`tools.py`)
   - 5 ä¸ª MCP å·¥å…·å‡½æ•°
   - ç»Ÿä¸€çš„é”™è¯¯å¤„ç†

3. **OCR å¼•æ“** (`ocr_engine.py`)
   - æŠ½è±¡åŸºç±» `OCREngine`
   - 4 ä¸ªå®ç°ï¼š`PaddleOCREngine`, `EasyOCREngine`, `DeepSeekOCREngine`, `PaddleOCRMCPEngine`
   - å·¥å‚æ¨¡å¼ç®¡ç†å¼•æ“å®ä¾‹ï¼ˆå•ä¾‹ï¼‰

4. **æ”¯æŒæ¨¡å—**
   - `logger.py`: æ—¥å¿—ç³»ç»Ÿï¼ˆæ–‡ä»¶æ—¥å¿— + MCP é€šçŸ¥ï¼‰
   - `progress_tracker.py`: è¿›åº¦è·Ÿè¸ª
   - `analysis_generator.py`: æŠ€æœ¯åˆ†æç”Ÿæˆå™¨
   - `models.py`: æ•°æ®æ¨¡å‹ï¼ˆOCRResult, BoundingBoxï¼‰
   - `config.py`: é…ç½®ç®¡ç†ï¼ˆç¯å¢ƒå˜é‡ï¼‰
   - `utils.py`: å·¥å…·å‡½æ•°ï¼ˆå›¾åƒéªŒè¯ï¼‰

### æ•°æ®æµ

```
ä»£ç†è¯·æ±‚
    â†“
MCP å·¥å…· (tools.py)
    â†“
å›¾åƒéªŒè¯ (utils.py)
    â†“
å¼•æ“å·¥å‚ (ocr_engine.py)
    â†“
OCR å¼•æ“å®ç°
    â†“
è¿›åº¦è·Ÿè¸ª + åˆ†æç”Ÿæˆ
    â†“
OCRResult
    â†“
ä»£ç†å“åº”
```

### è®¾è®¡åŸåˆ™

1. **ç»Ÿä¸€æ¥å£**: æ‰€æœ‰å¼•æ“å®ç°ç›¸åŒçš„æ¥å£
2. **å»¶è¿ŸåŠ è½½**: å¼•æ“åœ¨é¦–æ¬¡ä½¿ç”¨æ—¶åŠ è½½
3. **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œè¿”å›æ ¼å¼
4. **å¯é€‰ä¾èµ–**: å¼•æ“ä½œä¸ºå¯é€‰ä¾èµ–ï¼ŒæŒ‰éœ€å®‰è£…

---

## ğŸ¯ å¼•æ“æ¨è

### âœ… æ¨èä½¿ç”¨

**PaddleOCR**ï¼ˆæœ€æ¨èï¼‰
- ä¸­æ–‡è¯†åˆ«æ•ˆæœå¥½
- æ”¯æŒå¤šè¯­è¨€
- æä¾›æ–‡æœ¬å’Œè¾¹ç•Œæ¡†
- æ¨¡å‹é€‚ä¸­ï¼Œä¸‹è½½å¿«é€Ÿ
- å®‰è£…: `pip install -e ".[paddleocr]"`

**EasyOCR**ï¼ˆå¤šè¯­è¨€åœºæ™¯ï¼‰
- æ”¯æŒ 80+ è¯­è¨€
- æ˜“äºä½¿ç”¨
- å®‰è£…: `pip install -e ".[easyocr]"`

**paddleocr-mcp**ï¼ˆå®˜æ–¹ MCP å®ç°ï¼‰
- ä¸ PaddleOCR åŠŸèƒ½ç±»ä¼¼
- ä¿æŒå…¼å®¹æ€§

### âš ï¸ æš‚ä¸æ¨è

**DeepSeek OCR**
- æ¨¡å‹æ–‡ä»¶è¿‡å¤§ï¼ˆ~7.8GBï¼‰
- ä¸‹è½½æ—¶é—´é•¿
- å­˜å‚¨å ç”¨å¤§
- PaddleOCR å·²èƒ½æ»¡è¶³å¤§éƒ¨åˆ†éœ€æ±‚

---

## âš™ï¸ é…ç½®

### ç¯å¢ƒå˜é‡

- `PADDLEOCR_LANG`: PaddleOCR è¯­è¨€ä»£ç ï¼ˆé»˜è®¤: "ch"ï¼‰
- `DEEPSEEK_MODEL_NAME`: DeepSeek OCR æ¨¡å‹åç§°ï¼ˆé»˜è®¤: "deepseek-ai/deepseek-ocr"ï¼‰
- `DEEPSEEK_DEVICE`: DeepSeek OCR è®¾å¤‡ï¼ˆé»˜è®¤: "cpu" æˆ– "cuda"ï¼‰
- `PRELOAD_ENGINES`: é¢„åŠ è½½çš„å¼•æ“åˆ—è¡¨ï¼ˆé€—å·åˆ†éš”ï¼Œå¦‚ "paddleocr,easyocr"ï¼‰
- `LOG_LEVEL`: æ—¥å¿—çº§åˆ«ï¼ˆé»˜è®¤: "INFO"ï¼‰
- `LOG_FILE`: æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼ˆé»˜è®¤: "logs/ocr_service.log"ï¼‰

### MCP é…ç½®

é…ç½®æ–‡ä»¶ä½ç½®ï¼š`~/.cursor/mcp.json`

```json
{
  "mcpServers": {
    "ocr-service": {
      "command": "ocr-mcp-server",
      "args": []
    }
  }
}
```

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### å·¥å…·ä¸å¯ç”¨

1. **æ£€æŸ¥é…ç½®**:
   ```bash
   python scripts/check_mcp_config.py
   ```

2. **é‡æ–°é…ç½®**:
   ```bash
   python scripts/setup_cursor.py --force
   ```

3. **é‡å¯ Cursor**: é…ç½®æ›´æ”¹åéœ€è¦å®Œå…¨é‡å¯ Cursor

### å¼•æ“åŠ è½½å¤±è´¥

1. **æ£€æŸ¥ä¾èµ–å®‰è£…**:
   ```bash
   pip list | grep paddleocr
   ```

2. **é‡æ–°å®‰è£…**:
   ```bash
   pip install -e ".[paddleocr]"
   ```

3. **æŸ¥çœ‹æ—¥å¿—**:
   ```bash
   # ä½¿ç”¨ get_recent_logs å·¥å…·æŸ¥çœ‹æ—¥å¿—
   # æˆ–æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
   cat logs/ocr_service.log
   ```

### å¸¸è§é”™è¯¯

- **ImportError**: å¼•æ“ä¾èµ–æœªå®‰è£…ï¼Œä½¿ç”¨ `pip install -e ".[engine_name]"` å®‰è£…
- **FileNotFoundError**: å›¾ç‰‡è·¯å¾„é”™è¯¯ï¼Œä½¿ç”¨ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹äºå·¥ä½œç›®å½•çš„è·¯å¾„
- **MemoryError**: å†…å­˜ä¸è¶³ï¼Œå°è¯•ä½¿ç”¨è¾ƒå°çš„å¼•æ“æˆ–å‡å°‘å¹¶å‘

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
ocr-mcp-service/
â”œâ”€â”€ src/ocr_mcp_service/     # æ ¸å¿ƒä»£ç 
â”‚   â”œâ”€â”€ __main__.py          # å…¥å£ç‚¹
â”‚   â”œâ”€â”€ mcp_server.py        # MCP æœåŠ¡å™¨
â”‚   â”œâ”€â”€ tools.py             # MCP å·¥å…·å®šä¹‰
â”‚   â”œâ”€â”€ ocr_engine.py        # OCR å¼•æ“å®ç°
â”‚   â”œâ”€â”€ logger.py            # æ—¥å¿—ç³»ç»Ÿ
â”‚   â”œâ”€â”€ progress_tracker.py  # è¿›åº¦è·Ÿè¸ª
â”‚   â”œâ”€â”€ analysis_generator.py # æŠ€æœ¯åˆ†æ
â”‚   â”œâ”€â”€ models.py            # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ config.py            # é…ç½®ç®¡ç†
â”‚   â””â”€â”€ utils.py             # å·¥å…·å‡½æ•°
â”œâ”€â”€ scripts/                 # å·¥å…·è„šæœ¬
â”œâ”€â”€ tests/                   # æµ‹è¯•ä»£ç 
â”œâ”€â”€ docs/                    # æ–‡æ¡£ï¼ˆæœ¬æ–‡æ¡£ï¼‰
â””â”€â”€ logs/                    # æ—¥å¿—æ–‡ä»¶
```

---

## ğŸ§ª æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/test_engines.py

# æµ‹è¯•ç‰¹å®šå¼•æ“
python scripts/verify_engines.py
```

---

## ğŸ“š å‚è€ƒèµ„æº

- [FastMCP æ–‡æ¡£](https://github.com/jlowin/fastmcp)
- [PaddleOCR æ–‡æ¡£](https://github.com/PaddlePaddle/PaddleOCR)
- [MCP åè®®è§„èŒƒ](https://modelcontextprotocol.io/)
- [EasyOCR æ–‡æ¡£](https://github.com/JaidedAI/EasyOCR)

---

**æ–‡æ¡£ç‰ˆæœ¬**: 0.1.0  
**æœ€åæ›´æ–°**: 2025-11-27
